<widget>
    <script th:inline="javascript">
        function requestContentMigration(event) {
            if (event) {
                event.preventDefault();
            }

            const url = [[${migrateHandlerUrl}]];

            const sourceId = document.getElementById('sourceId').value;
            const targetLocale = document.getElementById('localeSelector').value;
            const targetId = document.getElementById('targetId').value;

            fetch(`${url}?sourceId=${sourceId}&targetLocale=${targetLocale}&targetId=${targetId}`)
                .then((res) => {
                    if (res.ok) {
                        return res.json();
                    }

                    return { message: `En uventet feil oppsto: ${res.status} - ${res.statusText}`, result: 'error' };
                })
                .then(({ result, message }) => {
                    if (result === 'error') {
                        document.getElementById('error').innerHTML = message;
                    } else {
                        alert(message);
                    }
                }).catch(e => {
                    document.getElementById('error').innerHTML = `En uventet feil oppsto: ${e}`;
                });
        }
    </script>
    <div style="padding: 0.5rem">
        <form th:attr="onsubmit='requestContentMigration(event)'">
            <div style="margin-bottom: 0.75rem">
                <label for="localeSelector">Velg spr√•k-layer</label><br />
                <select
                    id="localeSelector"
                    style="-webkit-appearance: revert; margin-top: 0.25rem; height: 32px"
                    class="xp-admin-common-text-input option-filter-input"
                >
                    <option
                        data-th-each="locale : ${locales}"
                        data-th-text="${locale}"
                        data-th-value="${locale}"
                    ></option>
                </select>
            </div>
            <div>
                <label for="targetId">Ny contentId (samme som norsk versjon)</label><br />
                <input
                    type="text"
                    id="targetId"
                    class="xp-admin-common-text-input"
                    style="width: 100%"
                />
                <button
                    type="submit"
                    style="margin-top: 0.25rem; height: 32px"
                    class="xp-admin-common-button"
                >
                    <span>Flytt innhold</span>
                </button>
            </div>
            <input type="hidden" id="sourceId" data-th-value="${sourceId}" />
        </form>
        <div id="success" style="margin-top: 1rem; color: green" />
        <div id="error" style="margin-top: 1rem; color: red" />
    </div>
</widget>
