<xsl:if test="/result/menuitems//menuitem[@active = 'true'][parameters/parameter[@name = 'key'] != '']/menuitems/menuitem or /result/menuitems//menuitem[@path = 'true'][parameters/parameter[@name = 'key'] != '']/menuitems/menuitem[@active = 'true'][parameters/parameter[@name = 'key'] != '']">
    <nav class="related-content content-submenu">
        <ul>
            <xsl:apply-templates
                    select="/result/menuitems//menuitem[@path = 'true'][parameters/parameter[@name = 'key'] != ''][@key != menuitems/menuitem/@key]"/>
        </ul>
    </nav>
</xsl:if>

<xsl:template match="menuitem">
    <xsl:param name="level" as="xs:integer" select="0"/>
    <li>
        <a href="{portal:createPageUrl(@key,())}">
            <xsl:if test="current()/@active = 'true'">
                <xsl:attribute name="class" select="'selected'"/>
            </xsl:if>
            <span>
				<xsl:value-of select="stk:menu.menuitem-name(current())"/>
				</span>
        </a>
    </li>
    <xsl:if test="$level lt 2">
        <xsl:apply-templates select="menuitems/menuitem[parameters/parameter[@name = 'key'] != '']">
            <xsl:with-param name="level" select="$level + 1"/>
            <!-- Level stopper templaten fra å kalle seg selv rekursivt til det uendelige hvis mange nivåer i menystrukturen -->
        </xsl:apply-templates>
    </xsl:if>
</xsl:template>